traefik:
  tlsStore:
    default:
      defaultCertificate:
        secretName: wildcard-tls-certificate

  providers:
    kubernetesGateway:
      enabled: true
  global:
    checkNewVersion: false
    sendAnonymousUsage: false
  deployment:
    replicas: 3
    podDisruptionBudget:
      enabled: true
      minAvailable: 1
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: traefik
  nodeSelector:
    node-role.kubernetes.io/control-plane: "true"
  ports:
    webpublic:
      port: 8001
      expose:
        default: false
      exposedPort: 80
      protocol: TCP
      http:
        redirections:
          entryPoint:
            to: websecurepublic
            scheme: https
    websecurepublic:
      port: 8444
      expose:
        default: false
      exposedPort: 443
      protocol: TCP
      http:
        tls:
          enabled: true
        middlewares:
          - crowdsec-crowdsec-bouncer@kubernetescrd
    terrariapublic:
      port: 7777
      expose:
        default: false
      exposedPort: 7777
      protocol: TCP
    metrics:
      port: 9101
      expose:
        default: true
      exposedPort: 9101
      protocol: TCP

  # Enable experimental plugins for CrowdSec bouncer
  experimental:
    plugins:
      crowdsec-bouncer:
        moduleName: "github.com/maxlerebourg/crowdsec-bouncer-traefik-plugin"
        version: "v1.5.0"

  # Enable access logs for CrowdSec agent to parse
  logs:
    access:
      enabled: true
      format: json
      fields:
        headers:
          defaultMode: keep
          names:
            User-Agent: keep
            X-Forwarded-For: keep
            X-Real-IP: keep
