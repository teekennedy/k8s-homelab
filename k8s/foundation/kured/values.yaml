# https://github.com/kubereboot/charts/tree/main/charts/kured
kured:
  revisionHistoryLimit: 3
  # https://kured.dev/docs/configuration/
  configuration:
    timeZone: America/Denver
    prometheusUrl: http://monitoring-system-kube-pro-prometheus.monitoring-system.svc.cluster.local:9090
    # kured uses the shoutrrr library for sending notifications
    # Shoutrrr docs for generic webhooks: https://containrrr.dev/shoutrrr/v0.7/services/generic/
    notifyUrl: generic+http://kured-webhook.kured.svc.cluster.local:8080
    messageTemplateDrain: "event=drain node=%s"
    messageTemplateReboot: "event=reboot node=%s"
    messageTemplateUncordon: "event=uncordon node=%s"
    # How often to check for sentinel file
    period: "30m0s"
    rebootCommand: "/run/current-system/sw/bin/systemctl reboot"
    alertFilterRegexp: "^(KubeVersionMismatch|LonghornVolumeActualSpaceUsedWarning|LonghornNodeStorageWarning|LonghornDiskStorageWarning)$"
    # Give drain operation up to 30 minutes to complete (for Longhorn replica evacuation)
    drainTimeout: "30m"
    # Keep trying to evict pods for up to 30 minutes before giving up
    skipWaitForDeleteTimeoutSeconds: 1800

webhook:
  enabled: true
  image:
    repository: python
    tag: 3.12-alpine
  events:
    enabled: true
    eventBusName: kured-webhook
    eventSourceName: kured-webhook-configmap
    sensorName: kured-webhook-restart
    eventSourceServiceAccount: kured-webhook-eventsource
    sensorServiceAccount: kured-webhook-sensor
    configMapName: kured-webhook
    deploymentName: kured-webhook
    annotationKey: kured-webhook-restarted-at
  alertmanagerUrl: http://monitoring-system-kube-pro-alertmanager.monitoring-system.svc.cluster.local:9093
  drainSilenceDuration: 1h
  drainSilenceAlerts:
    - LonghornVolumeStatusWarning
    - LonghornVolumeActualSpaceUsedWarning
    - NodeSystemSaturation
    - NodeCPUHighUsage
    - LonghornInstanceManagerCPUUsageWarning
  postRebootSilenceDuration: 15m
  rebootAlertTtl: 6h
  postRebootSilenceAlerts:
    - KubePodNotReady
    - KubeDaemonSetRolloutStuck
    - LonghornNodeDown
